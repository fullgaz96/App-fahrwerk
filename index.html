<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üèçÔ∏è Fahrwerksprotokoll & Reifenlager</title>
  <style>
    body { font-family: -apple-system, sans-serif; background: #121212; color: #f0f0f0; padding: 20px; margin: 0; }
    h1 { color: #3a85ff; }
    fieldset { border: 1px solid #444; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #1e1e1e; }
    legend { font-weight: bold; color: #3a85ff; }
    label { display: block; margin: 10px 0 4px; font-weight: bold; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #444; border-radius: 6px; background: #2d2d2d; color: #f0f0f0; }
    .btn { padding: 14px 20px; font-size: 18px; background: #3a85ff; color: white; border: none; border-radius: 8px; cursor: pointer; width: 100%; margin: 15px 0; }
    .hidden { display: none; }
    .reifen-item { display:flex; justify-content: space-between; align-items:center; background: #2d2d2d; padding: 6px 10px; border-radius:6px; margin-bottom:5px; }
    .reifen-buttons button { margin-left:4px; padding:2px 6px; border-radius:4px; border:none; cursor:pointer; }
    .reifen-buttons button.green{background:#4CAF50;color:white;}
    .reifen-buttons button.red{background:#f44336;color:white;}
    .reifen-buttons button.gray{background:#888;color:white;}
  </style>
</head>
<body>
<h1>üèçÔ∏è Fahrwerksprotokoll & Reifenlager</h1>

<!-- Fahrwerksprotokoll -->
<form id="fahrwerkForm">
  <fieldset>
    <legend>Grunddaten</legend>
    <label>Motorrad</label>
    <select id="motorrad" required>
      <option value="GSX-R 750">GSX-R 750</option>
      <option value="SV 650">SV 650</option>
      <option value="GS 500E">GS 500E</option>
    </select>
    <label>Strecke</label>
    <select id="strecke" required>
      <option value="">-- w√§hlen --</option>
      <option value="OSL">Oschersleben</option>
      <option value="SAC">Sachsenring</option>
      <option value="STC">Spreewaldring</option>
      <option value="GD">Gros Doelln</option>
      <option value="MST">Most</option>
      <option value="HARZ">Harzring</option>
      <option value="HDBR">Heidbergring</option>
      <option value="BRN">Br√ºnn</option>
      <option value="LSR">Lausitzring</option>
      <option value="TPZ">Tor Pozna≈Ñ</option>
      <option value="custom">nicht dabei</option>
    </select>
    <div id="customContainer" class="hidden">
      <label>Strecke (manuell)</label>
      <input type="text" id="streckeCustom" placeholder="z.‚ÄØB. Hockenheim" />
    </div>
    <label>Session</label>
    <input type="text" id="session" placeholder="z.B. TR1" />
    <label>Datum</label>
    <input type="date" id="datum" required />
  </fieldset>

  <fieldset>
    <legend>Reifen</legend>
    <label>Vorne:</label>
    <select id="reifenVorne"></select>
    <label>Hinten:</label>
    <select id="reifenHinten"></select>
  </fieldset>

  <fieldset>
    <legend>Fahrwerk</legend>
    <label>Gabel</label><input type="text" id="gabel">
    <label>Federbein</label><input type="text" id="federbein">
    <label>√úbersetzung</label><input type="text" id="uebersetzung">
    <label>Kettenspannung</label><input type="text" id="kettenspannung">
  </fieldset>

  <fieldset>
    <legend>Notizen</legend>
    <textarea id="notizen"></textarea>
  </fieldset>

  <button type="button" class="btn" onclick="generateMarkdown()">Markdown exportieren</button>
</form>

<!-- Reifenlager -->
<div class="p-4 border rounded dark:border-gray-700 mt-6">
  <h2 class="text-lg font-bold mb-4">Reifenlager</h2>

  <div class="space-x-2 mb-4">
    <button onclick="saveReifenlager()" class="bg-blue-500 text-white px-4 py-2 rounded">Reifenlager speichern</button>
    <input type="file" id="reifenlagerFile" accept=".json" onchange="loadReifenlager(event)" class="bg-gray-700 text-white px-4 py-2 rounded">
  </div>

  <div class="flex gap-2 mb-4">
    <input type="text" id="neuerReifenName" placeholder="Reifenname" class="flex-1 p-2 rounded bg-gray-800 text-white">
    <button onclick="addReifen()" class="bg-green-500 text-white px-4 py-2 rounded">+ Reifen</button>
  </div>

  <div id="reifenlagerList"></div>
</div>

<script>
document.getElementById("datum").valueAsDate = new Date();
document.getElementById("strecke").addEventListener("change", () => {
  document.getElementById("customContainer").classList.toggle("hidden", document.getElementById("strecke").value !== "custom");
});

// Reifenlager
let reifenlager = [];

function addReifen() {
  const name = document.getElementById("neuerReifenName").value.trim();
  if(!name) return;
  reifenlager.push({name, turns:0, heizzyklen:0});
  document.getElementById("neuerReifenName").value = "";
  renderReifenlager();
}

function removeReifen(index) {
  if(confirm(`Reifen "${reifenlager[index].name}" wirklich entfernen?`)) {
    reifenlager.splice(index,1);
    renderReifenlager();
  }
}

function updateReifen(index, field, diff){
  reifenlager[index][field] = Math.max(0, reifenlager[index][field]+diff);
  renderReifenlager();
}

function renderReifenlager(){
  const list = document.getElementById("reifenlagerList");
  const reifenVorne = document.getElementById("reifenVorne");
  const reifenHinten = document.getElementById("reifenHinten");
  list.innerHTML = "";
  reifenVorne.innerHTML = "";
  reifenHinten.innerHTML = "";

  reifenlager.forEach((reifen,index)=>{
    const div = document.createElement("div");
    div.className="reifen-item";
    div.innerHTML = `
      <span>${reifen.name} | Turns: ${reifen.turns} | Heizzyklen: ${reifen.heizzyklen}</span>
      <div class="reifen-buttons">
        <button class="green" onclick="updateReifen(${index},'turns',1)">+ Turn</button>
        <button class="red" onclick="updateReifen(${index},'turns',-1)">- Turn</button>
        <button class="green" onclick="updateReifen(${index},'heizzyklen',1)">+ Heiz</button>
        <button class="red" onclick="updateReifen(${index},'heizzyklen',-1)">- Heiz</button>
        <button class="gray" onclick="removeReifen(${index})">Entfernen</button>
      </div>
    `;
    list.appendChild(div);

    const opt1 = document.createElement("option"); opt1.value=reifen.name; opt1.textContent=reifen.name; reifenVorne.appendChild(opt1);
    const opt2 = document.createElement("option"); opt2.value=reifen.name; opt2.textContent=reifen.name; reifenHinten.appendChild(opt2);
  });
}

function saveReifenlager(){
  const blob = new Blob([JSON.stringify(reifenlager,null,2)], {type:"application/json"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download="reifenlager.json";
  link.click();
}

function loadReifenlager(event){
  const file = event.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e=>{
    try{reifenlager = JSON.parse(e.target.result);}catch{alert("Fehler beim Laden"); return;}
    renderReifenlager();
  };
  reader.readAsText(file);
}

// Markdown export
function generateMarkdown(){
  const f = id=>document.getElementById(id)?.value||"-";
  const text = `## Fahrwerksprotokoll
Datum: ${f("datum")}
Motorrad: ${f("motorrad")}
Strecke: ${f("strecke")}
Session: ${f("session")}

### Reifen
Vorne: ${f("reifenVorne")}
Hinten: ${f("reifenHinten")}

### Fahrwerk
Gabel: ${f("gabel")}
Federbein: ${f("federbein")}
√úbersetzung: ${f("uebersetzung")}
Kettenspannung: ${f("kettenspannung")}

### Notizen
${f("notizen")}
`.trim();

  const blob = new Blob([text],{type:"text/markdown"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  const d = new Date();
  const dateiname = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}_${f("motorrad")}_${f("strecke")}_${f("session")}.md`;
  link.download = dateiname;
  link.click();
}
</script>
</body>
</html>
