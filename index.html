<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>üèçÔ∏è Fahrwerksprotokoll</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body {
    font-family: -apple-system, sans-serif;
    background: #121212;
    color: #f0f0f0;
    padding: 20px;
    margin: 0;
  }
  h1 { color: #3a85ff; }
  fieldset {
    border: 1px solid #444;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background: #1e1e1e;
  }
  legend { font-weight: bold; color: #3a85ff; }
  label { display: block; margin: 10px 0 4px; font-weight: bold; }
  input, select { width: 100%; padding: 10px; border: 1px solid #444; border-radius: 6px; background: #2d2d2d; color: #f0f0f0; }
  .btn { padding: 14px 20px; font-size: 18px; background: #3a85ff; color: white; border: none; border-radius: 8px; cursor: pointer; width: 100%; margin: 15px 0; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { border: 1px solid #444; padding: 6px; text-align: center; }
  th { background: #2d2d2d; }
</style>
</head>
<body>
<h1>üèçÔ∏è Fahrwerksprotokoll</h1>

<fieldset>
  <legend>Fahrwerkslager</legend>
  <label>Motorrad ausw√§hlen</label>
  <select id="motorrad">
    <option value="GSXR">GSXR</option>
    <option value="GS500E">GS500E</option>
    <option value="SV650">SV650</option>
  </select>
  
  <label>Fahrwerksdaten laden (JSON)</label>
  <input type="file" id="fileInput" accept=".json" />
  
  <button type="button" class="btn" onclick="loadFahrwerk()">Daten laden</button>
  <button type="button" class="btn" onclick="saveFahrwerkJSON()">Als JSON speichern</button>
</fieldset>

<form id="form">
  <fieldset>
    <legend>Fahrwerksdaten</legend>
    <label>Gabelh√∂he (mm)</label>
    <input type="number" id="gabelHoehe" />
    <label>Gabel SAG statisch (mm)</label>
    <input type="number" id="sagVStatisch" />
    <label>Gabel SAG dynamisch (mm)</label>
    <input type="number" id="sagVDynamisch" />
    <label>Federrate Gabel (N/mm)</label>
    <input type="number" id="federV" step="0.1" />
    
    <label>Heckh√∂he (mm)</label>
    <input type="number" id="heckhoehe" />
    <label>Federbein SAG statisch (mm)</label>
    <input type="number" id="sagHStatisch" />
    <label>Federbein SAG dynamisch (mm)</label>
    <input type="number" id="sagHDynamisch" />
    <label>Federrate Federbein (N/mm)</label>
    <input type="number" id="federH" step="0.1" />
    <label>Notiz / Kommentar</label>
    <input type="text" id="notiz" placeholder="z.B. leicht angepasst" />
  </fieldset>
</form>

<fieldset>
  <legend>Historie</legend>
  <table id="historyTable">
    <thead>
      <tr>
        <th>Datum</th>
        <th>Gabelh√∂he</th>
        <th>SAG V statisch</th>
        <th>SAG V dynamisch</th>
        <th>Federrate V</th>
        <th>Heckh√∂he</th>
        <th>SAG H statisch</th>
        <th>SAG H dynamisch</th>
        <th>Federrate H</th>
        <th>Notiz</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="10">Keine Daten geladen</td></tr>
    </tbody>
  </table>
</fieldset>

<script>
  let fahrwerkData = { motorrad: "", historie: [] };
  let currentFileName = "";

  function updateHistoryTable() {
    const tbody = document.getElementById("historyTable").querySelector("tbody");
    tbody.innerHTML = "";
    if (!fahrwerkData.historie.length) {
      tbody.innerHTML = '<tr><td colspan="10">Keine Daten vorhanden</td></tr>';
      return;
    }
    fahrwerkData.historie.forEach(entry => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${new Date(entry.datum).toLocaleString()}</td>
        <td>${entry.gabelHoehe || "-"}</td>
        <td>${entry.sagVStatisch || "-"}</td>
        <td>${entry.sagVDynamisch || "-"}</td>
        <td>${entry.federV || "-"}</td>
        <td>${entry.heckhoehe || "-"}</td>
        <td>${entry.sagHStatisch || "-"}</td>
        <td>${entry.sagHDynamisch || "-"}</td>
        <td>${entry.federH || "-"}</td>
        <td>${entry.notiz || "-"}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function loadFahrwerk() {
    const fileInput = document.getElementById("fileInput");
    if (!fileInput.files.length) {
      alert("Bitte eine JSON-Datei ausw√§hlen!");
      return;
    }
    const file = fileInput.files[0];
    currentFileName = file.name;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        fahrwerkData = JSON.parse(e.target.result);
        document.getElementById("motorrad").value = fahrwerkData.motorrad || "GSXR";
        const last = fahrwerkData.historie[fahrwerkData.historie.length - 1] || {};
        document.getElementById("gabelHoehe").value = last.gabelHoehe || "";
        document.getElementById("sagVStatisch").value = last.sagVStatisch || "";
        document.getElementById("sagVDynamisch").value = last.sagVDynamisch || "";
        document.getElementById("federV").value = last.federV || "";
        document.getElementById("heckhoehe").value = last.heckhoehe || "";
        document.getElementById("sagHStatisch").value = last.sagHStatisch || "";
        document.getElementById("sagHDynamisch").value = last.sagHDynamisch || "";
        document.getElementById("federH").value = last.federH || "";
        document.getElementById("notiz").value = last.notiz || "";
        updateHistoryTable();
        alert("‚úÖ Fahrwerksdaten geladen!");
      } catch(err) {
        alert("Fehler beim Laden der JSON-Datei: " + err);
      }
    };
    reader.readAsText(file);
  }

  function saveFahrwerkJSON() {
    const newEntry = {
      datum: new Date().toISOString(),
      gabelHoehe: document.getElementById("gabelHoehe").value,
      sagVStatisch: document.getElementById("sagVStatisch").value,
      sagVDynamisch: document.getElementById("sagVDynamisch").value,
      federV: document.getElementById("federV").value,
      heckhoehe: document.getElementById("heckhoehe").value,
      sagHStatisch: document.getElementById("sagHStatisch").value,
      sagHDynamisch: document.getElementById("sagHDynamisch").value,
      federH: document.getElementById("federH").value,
      notiz: document.getElementById("notiz").value
    };
    
    if (!fahrwerkData.motorrad) {
      fahrwerkData.motorrad = document.getElementById("motorrad").value;
    }
    fahrwerkData.historie.push(newEntry);
    updateHistoryTable();

    const blob = new Blob([JSON.stringify(fahrwerkData, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = currentFileName || fahrwerkData.motorrad + "_fahrwerk.json";
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(a.href);
    }, 100);
    alert("‚úÖ JSON-Datei gespeichert!");
  }
</script>
</body>
</html>
