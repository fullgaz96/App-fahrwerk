<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>üèçÔ∏è Fahrwerksprotokoll</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body {
    font-family: -apple-system, sans-serif;
    background: #121212;
    color: #f0f0f0;
    padding: 20px;
    margin: 0;
  }
  h1 { color: #3a85ff; }
  fieldset {
    border: 1px solid #444;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background: #1e1e1e;
  }
  legend {
    font-weight: bold;
    color: #3a85ff;
  }
  label {
    display: block;
    margin: 10px 0 4px;
    font-weight: bold;
  }
  input, select {
    width: 100%;
    padding: 10px;
    border: 1px solid #444;
    border-radius: 6px;
    background: #2d2d2d;
    color: #f0f0f0;
  }
  .btn {
    padding: 14px 20px;
    font-size: 18px;
    background: #3a85ff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
    margin: 15px 0;
  }
</style>
</head>
<body>
<h1>üèçÔ∏è Fahrwerksprotokoll</h1>

<!-- Motorrad ausw√§hlen und JSON laden -->
<fieldset>
  <legend>Fahrwerkslager laden</legend>
  <label>Motorrad ausw√§hlen</label>
  <select id="motorrad">
    <option value="GSXR">GSXR</option>
    <option value="GS500E">GS500E</option>
    <option value="SV650">SV650</option>
  </select>
  <label>Fahrwerksdaten laden (JSON-Datei)</label>
  <input type="file" id="fileInput" accept=".json" />
  <button type="button" class="btn" onclick="loadFahrwerk()">Daten laden</button>
  <button type="button" class="btn" onclick="saveFahrwerkJSON()">Als JSON speichern</button>
</fieldset>

<!-- Fahrwerksformular -->
<form id="form">
  <fieldset>
    <legend>Fahrwerksdaten</legend>
    <label>Gabelh√∂he (mm)</label>
    <input type="number" id="gabelHoehe" />
    <label>Gabel SAG statisch (mm)</label>
    <input type="number" id="sagVStatisch" />
    <label>Gabel SAG dynamisch (mm)</label>
    <input type="number" id="sagVDynamisch" />
    <label>Federrate Gabel (N/mm)</label>
    <input type="number" id="federV" step="0.1" />
    
    <label>Heckh√∂he (mm)</label>
    <input type="number" id="heckhoehe" />
    <label>Federbein SAG statisch (mm)</label>
    <input type="number" id="sagHStatisch" />
    <label>Federbein SAG dynamisch (mm)</label>
    <input type="number" id="sagHDynamisch" />
    <label>Federrate Federbein (N/mm)</label>
    <input type="number" id="federH" step="0.1" />
  </fieldset>
  
  <button type="button" class="btn" onclick="downloadProtokoll()">üìù Markdown erstellen</button>
</form>

<script>
  let currentFileName = "";

  function loadFahrwerk() {
    const fileInput = document.getElementById("fileInput");
    if (!fileInput.files.length) {
      alert("Bitte eine JSON-Datei ausw√§hlen!");
      return;
    }
    const file = fileInput.files[0];
    currentFileName = file.name; // speichert den Dateinamen f√ºr sp√§tere Speicherung
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const data = JSON.parse(e.target.result);
        document.getElementById("gabelHoehe").value = data.gabelHoehe || "";
        document.getElementById("sagVStatisch").value = data.sagVStatisch || "";
        document.getElementById("sagVDynamisch").value = data.sagVDynamisch || "";
        document.getElementById("federV").value = data.federV || "";
        document.getElementById("heckhoehe").value = data.heckhoehe || "";
        document.getElementById("sagHStatisch").value = data.sagHStatisch || "";
        document.getElementById("sagHDynamisch").value = data.sagHDynamisch || "";
        document.getElementById("federH").value = data.federH || "";
        alert("‚úÖ Fahrwerksdaten geladen!");
      } catch (err) {
        alert("Fehler beim Laden der JSON-Datei: " + err);
      }
    };
    reader.readAsText(file);
  }

  function saveFahrwerkJSON() {
    if (!currentFileName) {
      alert("Bitte zuerst eine JSON-Datei laden!");
      return;
    }
    const data = {
      gabelHoehe: document.getElementById("gabelHoehe").value,
      sagVStatisch: document.getElementById("sagVStatisch").value,
      sagVDynamisch: document.getElementById("sagVDynamisch").value,
      federV: document.getElementById("federV").value,
      heckhoehe: document.getElementById("heckhoehe").value,
      sagHStatisch: document.getElementById("sagHStatisch").value,
      sagHDynamisch: document.getElementById("sagHDynamisch").value,
      federH: document.getElementById("federH").value
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = currentFileName; // speichert unter dem geladenen Dateinamen
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(a.href);
    }, 100);
    alert("‚úÖ JSON-Datei gespeichert: " + currentFileName);
  }

  function downloadProtokoll() {
    const d = id => document.getElementById(id).value || "-";
    const datum = new Date();
    const dateiname = `${datum.getFullYear()}-${(datum.getMonth()+1).toString().padStart(2,"0")}-${datum.getDate().toString().padStart(2,"0")}_Fahrwerksprotokoll.md`;
    
    const text = `## Fahrwerksprotokoll\n
Gabelh√∂he: ${d("gabelHoehe")} mm
Gabel SAG statisch: ${d("sagVStatisch")} mm
Gabel SAG dynamisch: ${d("sagVDynamisch")} mm
Federrate Gabel: ${d("federV")} N/mm

Heckh√∂he: ${d("heckhoehe")} mm
Federbein SAG statisch: ${d("sagHStatisch")} mm
Federbein SAG dynamisch: ${d("sagHDynamisch")} mm
Federrate Federbein: ${d("federH")} N/mm
`.trim();

    const blob = new Blob([text], { type: "text/markdown" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = dateiname;
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 100);
    alert("‚úÖ Markdown-Datei erstellt: " + dateiname);
  }
</script>
</body>
</html>
