<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Fahrwerksdaten</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #e0e0e0;
      padding: 20px;
    }
    label { display: block; margin-top: 10px; }
    input, select, textarea {
      width: 100%; padding: 6px; margin-top: 4px;
      background: #1e1e1e; color: #fff; border: 1px solid #333;
    }
    button {
      margin-top: 10px; padding: 10px 15px;
      background: #333; color: #fff; border: none; cursor: pointer;
    }
    button:hover { background: #555; }
    .historie { margin-top: 30px; padding: 10px; border: 1px solid #444; }
    .historie-entry { border-bottom: 1px solid #333; margin-bottom: 10px; padding-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Fahrwerksdaten Protokoll</h1>

  <form id="fahrwerkForm">
    <label>Motorrad:
      <select id="motorrad" name="motorrad">
        <option value="GSXR750">GSX-R 750</option>
        <option value="SV650">SV 650</option>
        <option value="GS500E">GS 500E</option>
      </select>
    </label>

    <label>Gabelh√∂he (mm): <input type="number" id="gabelHoehe"></label>
    <label>SAG vorne statisch (mm): <input type="number" id="sagVStatisch"></label>
    <label>SAG vorne dynamisch (mm): <input type="number" id="sagVDynamisch"></label>
    <label>Federrate vorne (N/mm): <input type="number" id="federV"></label>
    <label>Vorspannung vorne (mm): <input type="number" id="vorspannungV"></label>
    <label>Druckstufe vorne (Umdr): <input type="number" id="druckV"></label>
    <label>Zugstufe vorne (Umdr): <input type="number" id="zugV"></label>
    <label>Bemerkungen:
      <textarea id="bemerkungen"></textarea>
    </label>

    <button type="button" onclick="saveData()">üíæ Speichern in JSON</button>
    <button type="button" onclick="loadFile()">üìÇ JSON Laden</button>
    <button type="button" onclick="exportMarkdown()">üìù MD-Export</button>
  </form>

  <div class="historie" id="historie">
    <h2>Historie</h2>
    <div id="historieList"></div>
  </div>

  <script>
    let fahrwerkData = { historie: [] };

    function saveData() {
      const entry = {
        datum: new Date().toLocaleString(),
        motorrad: document.getElementById("motorrad").value,
        gabelHoehe: document.getElementById("gabelHoehe").value,
        sagVStatisch: document.getElementById("sagVStatisch").value,
        sagVDynamisch: document.getElementById("sagVDynamisch").value,
        federV: document.getElementById("federV").value,
        vorspannungV: document.getElementById("vorspannungV").value,
        druckV: document.getElementById("druckV").value,
        zugV: document.getElementById("zugV").value,
        bemerkungen: document.getElementById("bemerkungen").value
      };
      fahrwerkData.historie.push(entry);
      updateHistorie();

      const blob = new Blob([JSON.stringify(fahrwerkData, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${entry.motorrad}_fahrwerk.json`;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{document.body.removeChild(a);},100);
    }

    function loadFile() {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = event => {
          fahrwerkData = JSON.parse(event.target.result);
          if (fahrwerkData.historie && fahrwerkData.historie.length > 0) {
            const last = fahrwerkData.historie[fahrwerkData.historie.length-1];
            document.getElementById("motorrad").value = last.motorrad || "";
            document.getElementById("gabelHoehe").value = last.gabelHoehe || "";
            document.getElementById("sagVStatisch").value = last.sagVStatisch || "";
            document.getElementById("sagVDynamisch").value = last.sagVDynamisch || "";
            document.getElementById("federV").value = last.federV || "";
            document.getElementById("vorspannungV").value = last.vorspannungV || "";
            document.getElementById("druckV").value = last.druckV || "";
            document.getElementById("zugV").value = last.zugV || "";
            document.getElementById("bemerkungen").value = last.bemerkungen || "";
          }
          updateHistorie();
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function updateHistorie() {
      const list = document.getElementById("historieList");
      list.innerHTML = "";
      fahrwerkData.historie.forEach((e, i) => {
        const div = document.createElement("div");
        div.className = "historie-entry";
        div.innerHTML = `<b>${e.datum}</b> ‚Äì ${e.motorrad}<br>
          Gabelh√∂he: ${e.gabelHoehe} mm, SAG stat: ${e.sagVStatisch} mm, SAG dyn: ${e.sagVDynamisch} mm<br>
          Federrate: ${e.federV} N/mm, Vorspannung: ${e.vorspannungV} mm<br>
          Druckstufe: ${e.druckV} Umdr, Zugstufe: ${e.zugV} Umdr<br>
          Bemerkungen: ${e.bemerkungen || "-"}
        `;
        list.appendChild(div);
      });
    }

    function exportMarkdown() {
      const motorrad = document.getElementById("motorrad").value;
      let md = `# Fahrwerksdaten ${motorrad}\n\n`;

      fahrwerkData.historie.forEach((e, i) => {
        md += `## Eintrag ${i+1} ‚Äì ${e.datum}\n`;
        md += `- Motorrad: ${e.motorrad}\n`;
        md += `- Gabelh√∂he: ${e.gabelHoehe} mm\n`;
        md += `- Gabel SAG statisch: ${e.sagVStatisch} mm\n`;
        md += `- Gabel SAG dynamisch: ${e.sagVDynamisch} mm\n`;
        md += `- Federrate: ${e.federV} N/mm\n`;
        md += `- Federvorspannung: ${e.vorspannungV} mm\n`;
        md += `- Druckstufe: ${e.druckV} Umdr\n`;
        md += `- Zugstufe: ${e.zugV} Umdr\n`;
        md += `- Bemerkungen: ${e.bemerkungen || "-"}\n\n`;
      });

      const blob = new Blob([md], {type:"text/markdown"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${motorrad}_fahrwerksdaten.md`;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{document.body.removeChild(a);},100);
      alert("‚úÖ Markdown exportiert!");
    }
  </script>
</body>
</html>
