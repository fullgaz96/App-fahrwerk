<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>üèçÔ∏è Fahrwerksprotokoll</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: -apple-system, sans-serif; background:#121212; color:#f0f0f0; padding:20px; margin:0;}
  h1 { color:#3a85ff; }
  fieldset { border:1px solid #444; border-radius:8px; padding:15px; margin-bottom:15px; background:#1e1e1e; }
  legend { font-weight:bold; color:#3a85ff; }
  label { display:block; margin:10px 0 4px; font-weight:bold; }
  input, select, textarea { width:100%; padding:10px; border:1px solid #444; border-radius:6px; background:#2d2d2d; color:#f0f0f0; }
  .btn { padding:14px 20px; font-size:18px; background:#3a85ff; color:white; border:none; border-radius:8px; cursor:pointer; width:100%; margin:15px 0; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #444; padding:8px; text-align:left; }
  th { background:#2d2d2d; }
</style>
</head>
<body>
<h1>üèçÔ∏è Fahrwerksprotokoll</h1>

<!-- Datei laden -->
<fieldset>
  <legend>Fahrwerksdaten Datei</legend>
  <input type="file" id="fileInput" />
  <button type="button" class="btn" onclick="loadFahrwerk()">üìÇ Datei laden</button>
  <button type="button" class="btn" onclick="saveFahrwerk()">üíæ Datei speichern</button>
</fieldset>

<!-- Motorrad Auswahl -->
<fieldset>
  <legend>Motorrad</legend>
  <label>Motorrad</label>
  <select id="motorrad">
    <option value="GSXR">GSXR</option>
    <option value="GS500E">GS500E</option>
    <option value="SV650">SV650</option>
  </select>
</fieldset>

<!-- Fahrwerk -->
<fieldset>
  <legend>Fahrwerksdaten</legend>
  <label>Gabelh√∂he (mm)</label><input type="number" id="gabelHoehe">
  <label>Gabel SAG statisch (mm)</label><input type="number" id="sagVStatisch">
  <label>Gabel SAG dynamisch (mm)</label><input type="number" id="sagVDynamisch">
  <label>Federrate V (N/mm)</label><input type="number" step="0.1" id="federV">
  <label>Heckh√∂he (mm)</label><input type="number" id="heckhoehe">
  <label>Federbein SAG statisch (mm)</label><input type="number" id="sagHStatisch">
  <label>Federbein SAG dynamisch (mm)</label><input type="number" id="sagHDynamisch">
  <label>Federrate H (N/mm)</label><input type="number" step="0.1" id="federH">
  <label>Notizen</label><textarea id="notiz"></textarea>
</fieldset>

<!-- Historie -->
<fieldset>
  <legend>Historie</legend>
  <table id="historyTable">
    <thead>
      <tr>
        <th>Datum/Uhrzeit</th>
        <th>Gabelh√∂he</th>
        <th>SAG V statisch/dynamisch</th>
        <th>Federrate V</th>
        <th>Heckh√∂he</th>
        <th>SAG H statisch/dynamisch</th>
        <th>Federrate H</th>
        <th>Notiz</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</fieldset>

<button type="button" class="btn" onclick="addEntry()">‚ûï Neuer Eintrag</button>

<script>
let fahrwerkData = { motorrad: "GSXR", historie: [] };
let currentFileName = "";

function loadFahrwerk() {
  const fileInput = document.getElementById("fileInput");
  if (!fileInput.files.length) { alert("Bitte eine JSON-Datei ausw√§hlen!"); return; }
  const file = fileInput.files[0];
  currentFileName = file.name;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      fahrwerkData = JSON.parse(e.target.result);
      if (!fahrwerkData.historie) fahrwerkData.historie = [];
      if (!fahrwerkData.motorrad) fahrwerkData.motorrad = document.getElementById("motorrad").value;
      document.getElementById("motorrad").value = fahrwerkData.motorrad;
      const last = fahrwerkData.historie[fahrwerkData.historie.length-1] || {};
      document.getElementById("gabelHoehe").value = last.gabelHoehe || "";
      document.getElementById("sagVStatisch").value = last.sagVStatisch || "";
      document.getElementById("sagVDynamisch").value = last.sagVDynamisch || "";
      document.getElementById("federV").value = last.federV || "";
      document.getElementById("heckhoehe").value = last.heckhoehe || "";
      document.getElementById("sagHStatisch").value = last.sagHStatisch || "";
      document.getElementById("sagHDynamisch").value = last.sagHDynamisch || "";
      document.getElementById("federH").value = last.federH || "";
      document.getElementById("notiz").value = last.notiz || "";
      updateHistoryTable();
      alert("‚úÖ Fahrwerksdaten geladen!");
    } catch(err) { alert("Fehler beim Laden der JSON-Datei: " + err); }
  };
  reader.readAsText(file);
}

function saveFahrwerk() {
  const blob = new Blob([JSON.stringify(fahrwerkData, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = currentFileName || `fahrwerk_${new Date().toISOString().split("T")[0]}.json`;
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{document.body.removeChild(a);},100);
}

function addEntry() {
  const entry = {
    timestamp: new Date().toLocaleString(),
    gabelHoehe: document.getElementById("gabelHoehe").value,
    sagVStatisch: document.getElementById("sagVStatisch").value,
    sagVDynamisch: document.getElementById("sagVDynamisch").value,
    federV: document.getElementById("federV").value,
    heckhoehe: document.getElementById("heckhoehe").value,
    sagHStatisch: document.getElementById("sagHStatisch").value,
    sagHDynamisch: document.getElementById("sagHDynamisch").value,
    federH: document.getElementById("federH").value,
    notiz: document.getElementById("notiz").value
  };
  fahrwerkData.historie.push(entry);
  updateHistoryTable();
}

function updateHistoryTable() {
  const tbody = document.querySelector("#historyTable tbody");
  tbody.innerHTML = "";
  fahrwerkData.historie.forEach(e=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${e.timestamp}</td>
                    <td>${e.gabelHoehe}</td>
                    <td>${e.sagVStatisch}/${e.sagVDynamisch}</td>
                    <td>${e.federV}</td>
                    <td>${e.heckhoehe}</td>
                    <td>${e.sagHStatisch}/${e.sagHDynamisch}</td>
                    <td>${e.federH}</td>
                    <td>${e.notiz}</td>`;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
