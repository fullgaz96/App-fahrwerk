<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>üèçÔ∏è Fahrwerksprotokoll</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: -apple-system, sans-serif;
      background: #121212;
      color: #f0f0f0;
      padding: 20px;
      margin: 0;
    }
    h1 { color: #3a85ff; }
    fieldset {
      border: 1px solid #444;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      background: #1e1e1e;
    }
    legend { font-weight: bold; color: #3a85ff; }
    label { display: block; margin: 10px 0 4px; font-weight: bold; }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #444;
      border-radius: 6px;
      background: #2d2d2d;
      color: #f0f0f0;
    }
    .btn {
      padding: 14px 20px;
      font-size: 18px;
      background: #3a85ff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      margin: 15px 0;
    }
    .hidden { display: none; }
    .historie { margin-top: 15px; }
    .historie-entry { border-bottom: 1px solid #444; padding: 8px 0; }
  </style>
</head>
<body>
  <h1>üèçÔ∏è Fahrwerksprotokoll</h1>

  <!-- Motorrad ausw√§hlen -->
  <fieldset>
    <legend>Motorrad</legend>
    <label>Motorrad</label>
    <select id="motorrad">
      <option value="GSXR">GSXR</option>
      <option value="GS500E">GS500E</option>
      <option value="SV650">SV650</option>
    </select>
    <label>JSON-Datei laden</label>
    <input type="file" id="jsonLoader" />
  </fieldset>

  <!-- Fahrwerksdaten -->
  <form id="form">
    <fieldset>
      <legend>Fahrwerksdaten</legend>
      <label>Gabelh√∂he (mm)</label><input type="number" id="gabelHoehe" />
      <label>Gabel SAG statisch (mm)</label><input type="number" id="sagVStatisch" />
      <label>Gabel SAG dynamisch (mm)</label><input type="number" id="sagVDynamisch" />
      <label>Federrate (N/mm)</label><input type="number" id="federV" step="0.1" />
      <label>Federvorspannung (mm)</label><input type="number" id="vorspannungV" />
      <label>Druckstufe (Umdr)</label><input type="text" id="druckV" />
      <label>Zugstufe (Umdr)</label><input type="text" id="zugV" />
      <label>Bemerkungen</label><textarea id="bemerkungen"></textarea>
    </fieldset>
    <button type="button" class="btn" onclick="speichern()">üíæ Speichern in JSON</button>
    <button type="button" class="btn" onclick="exportMarkdown()">üìù MD-Export</button>
  </form>

  <!-- Historie -->
  <fieldset>
    <legend>Historie</legend>
    <div id="historieContainer" class="historie"></div>
  </fieldset>

<script>
let fahrwerkData = { historie: [] };

// Datei laden
document.getElementById("jsonLoader").addEventListener("change", async (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const text = await file.text();
  try {
    fahrwerkData = JSON.parse(text);
    if (!fahrwerkData.historie) fahrwerkData.historie = [];
    ladeLetztenEintrag();
    renderHistorie();
    alert("‚úÖ JSON geladen!");
  } catch(err) {
    alert("‚ùå Fehler beim Laden: " + err);
  }
});

// Letzten Eintrag ins Formular laden
function ladeLetztenEintrag() {
  if (fahrwerkData.historie.length === 0) return;
  const last = fahrwerkData.historie[fahrwerkData.historie.length-1];
  for (let key in last) {
    const el = document.getElementById(key);
    if (el) el.value = last[key];
  }
}

// Speichern neuer Eintrag
function speichern() {
  const d = {};
  ["gabelHoehe","sagVStatisch","sagVDynamisch","federV","vorspannungV","druckV","zugV","bemerkungen"].forEach(id => {
    d[id] = document.getElementById(id).value;
  });
  d.datum = new Date().toLocaleString();
  fahrwerkData.historie.push(d);
  renderHistorie();
  const blob = new Blob([JSON.stringify(fahrwerkData, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = document.getElementById("motorrad").value + "_fahrwerksdaten.json";
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{document.body.removeChild(a);},100);
  alert("‚úÖ Fahrwerksdaten gespeichert!");
}

// Historie anzeigen
function renderHistorie() {
  const container = document.getElementById("historieContainer");
  container.innerHTML = "";
  fahrwerkData.historie.slice().reverse().forEach((entry, i) => {
    const div = document.createElement("div");
    div.className = "historie-entry";
    div.textContent = `${entry.datum} ‚Äì Gabelh√∂he: ${entry.gabelHoehe} mm, SAG V statisch: ${entry.sagVStatisch} mm, Bemerkungen: ${entry.bemerkungen || "-"}`;
    container.appendChild(div);
  });
}

// MD-Export
function exportMarkdown() {
  const motorrad = document.getElementById("motorrad").value;
  let md = `# Fahrwerksdaten ${motorrad}\n\n`;
  fahrwerkData.historie.forEach((e, i) => {
    md += `## Eintrag ${i+1} ‚Äì ${e.datum}\n`;
    md += `- Gabelh√∂he: ${e.gabelHoehe} mm\n`;
    md += `- Gabel SAG statisch: ${e.sagVStatisch} mm\n`;
    md += `- Gabel SAG dynamisch: ${e.sagVDynamisch} mm\n`;
    md += `- Federrate: ${e.federV} N/mm\n`;
    md += `- Federvorspannung: ${e.vorspannungV} mm\n`;
    md += `- Druckstufe: ${e.druckV} Umdr\n`;
    md += `- Zugstufe: ${e.zugV} Umdr\n`;
    md += `- Bemerkungen: ${e.bemerkungen || "-"}\n\n`;
  });
  const blob = new Blob([md], {type:"text/markdown"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = motorrad + "_fahrwerksdaten.md";
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{document.body.removeChild(a);},100);
  alert("‚úÖ Markdown exportiert!");
}
</script>
</body>
</html>
