<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Fahrwerksprotokoll & Reifenlager</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 5px; margin-top: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: center; }
    button { margin: 5px; padding: 6px 10px; }
  </style>
</head>
<body>
  <h1>Fahrwerksprotokoll</h1>
  <form id="setupForm">
    <label>Motorradmodell: <input type="text" id="motorrad"></label>
    <label>Rennstrecke: <input type="text" id="strecke"></label>
    <label>SAG Gabel (mm): <input type="number" id="sagGabel"></label>
    <label>SAG Federbein (mm): <input type="number" id="sagFederbein"></label>
    <label>Feder Gabel: <input type="text" id="federGabel"></label>
    <label>Feder Federbein: <input type="text" id="federFederbein"></label>
    <label>Reifen vorne:
      <select id="reifenVorne"></select>
    </label>
    <label>Reifen hinten:
      <select id="reifenHinten"></select>
    </label>
    <label>Antrieb (Kettenspannung/Übersetzung): <input type="text" id="antrieb"></label>
    <label>Bemerkungen:
      <textarea id="bemerkungen"></textarea>
    </label>
    <label>Bestzeit: <input type="text" id="bestzeit"></label>
    <button type="button" onclick="exportMarkdown()">Markdown exportieren</button>
  </form>

  <h2>Reifenlager</h2>
  <input type="file" id="reifenlagerInput" accept=".json">
  <button onclick="loadReifenlager()">Reifenlager laden</button>
  <button onclick="saveReifenlager()">Reifenlager speichern</button>

  <table id="reifenTable">
    <thead>
      <tr>
        <th>Bezeichnung</th>
        <th>Position</th>
        <th>Turns</th>
        <th>Heizzyklen</th>
        <th>Aktionen</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let reifenlager = [];

    // Markdown Export
    function exportMarkdown() {
      const data = {
        Motorrad: document.getElementById("motorrad").value,
        Rennstrecke: document.getElementById("strecke").value,
        SAG_Gabel: document.getElementById("sagGabel").value,
        SAG_Federbein: document.getElementById("sagFederbein").value,
        Feder_Gabel: document.getElementById("federGabel").value,
        Feder_Federbein: document.getElementById("federFederbein").value,
        Reifen_vorne: document.getElementById("reifenVorne").value,
        Reifen_hinten: document.getElementById("reifenHinten").value,
        Antrieb: document.getElementById("antrieb").value,
        Bemerkungen: document.getElementById("bemerkungen").value,
        Bestzeit: document.getElementById("bestzeit").value,
      };

      let md = `# Fahrwerksprotokoll\n`;
      for (const [key, val] of Object.entries(data)) {
        md += `- **${key}**: ${val}\n`;
      }

      const blob = new Blob([md], { type: "text/markdown" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "fahrwerksprotokoll.md";
      a.click();
    }

    // Reifenlager laden
    function loadReifenlager() {
      const input = document.getElementById("reifenlagerInput");
      const file = input.files[0];
      if (!file) {
        alert("Bitte eine reifenlager.json auswählen!");
        return;
      }
      const reader = new FileReader();
      reader.onload = e => {
        try {
          reifenlager = JSON.parse(e.target.result);
          updateReifenUI();
        } catch (err) {
          alert("Fehler beim Laden der JSON!");
        }
      };
      reader.readAsText(file);
    }

    // Reifenlager speichern
    function saveReifenlager() {
      const blob = new Blob([JSON.stringify(reifenlager, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "reifenlager.json";
      a.click();
    }

    // UI aktualisieren
    function updateReifenUI() {
      const tableBody = document.querySelector("#reifenTable tbody");
      tableBody.innerHTML = "";
      const vorneSelect = document.getElementById("reifenVorne");
      const hintenSelect = document.getElementById("reifenHinten");
      vorneSelect.innerHTML = "";
      hintenSelect.innerHTML = "";

      reifenlager.forEach((reifen, index) => {
        // Tabelle
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${reifen.name}</td>
          <td>${reifen.position}</td>
          <td>${reifen.turns}</td>
          <td>${reifen.heizzyklen}</td>
          <td>
            <button onclick="changeValue(${index}, 'turns', 1)">+Turn</button>
            <button onclick="changeValue(${index}, 'turns', -1)">-Turn</button>
            <button onclick="changeValue(${index}, 'heizzyklen', 1)">+Heiz</button>
            <button onclick="changeValue(${index}, 'heizzyklen', -1)">-Heiz</button>
          </td>
        `;
        tableBody.appendChild(row);

        // Dropdowns
        const option = document.createElement("option");
        option.value = reifen.name;
        option.textContent = reifen.name;
        if (reifen.position === "vorne") vorneSelect.appendChild(option);
        if (reifen.position === "hinten") hintenSelect.appendChild(option);
      });
    }

    // Werte ändern
    function changeValue(index, field, diff) {
      reifenlager[index][field] = Math.max(0, reifenlager[index][field] + diff);
      updateReifenUI();
    }
  </script>
</body>
</html>
